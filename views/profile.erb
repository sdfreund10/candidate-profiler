<div class="profile-layout">
  <%# Loading UI; updates stream in via turbo-stream-source (SSE), then final replace via Turbo Stream %>

  <turbo-frame id="profile" data-turbo-frame="_top">
    <div class="loading-page-wrap">
      <div class="hero research-loading loading-page-hero" data-url="<%= ERB::Util.html_escape(campaign_url) %>">
        <h1>Researching candidate...</h1>
        <p class="tagline">This usually takes a few minutes</p>
        <div class="spinner spinner-ring" aria-hidden="true"></div>
        <div id="status-updates">
        </div>
      </div>
    </div>
  </turbo-frame>

  <turbo-stream-source src="/candidate-profile?campaign_url=<%= ERB::Util.html_escape(URI.encode_www_form_component(campaign_url)) %>"></turbo-stream-source>
</div>

<style>
.profile-layout { max-width: 720px; margin: 0 auto; width: 100%; }
.profile-nav { display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 0.75rem; margin-bottom: 1.5rem; }
.profile-back { color: #2563eb; text-decoration: none; font-size: 0.9375rem; }
.profile-back:hover { text-decoration: underline; }
.view-toggle { display: inline-flex; border: 1px solid #e5e7eb; border-radius: 6px; overflow: hidden; }
.view-toggle-btn { display: inline-flex; align-items: center; gap: 0.35rem; padding: 0.4rem 0.75rem; font-size: 0.875rem; background: #fff; color: #6b7280; border: none; cursor: pointer; }
.view-toggle-btn svg { flex-shrink: 0; }
.view-toggle-btn.active { background: #333; color: #fff; }
.view-toggle-btn:not(.active):hover { background: #f9fafb; }
.profile-view.hidden { display: none; }
.profile-cards { display: flex; flex-direction: column; gap: 1rem; }
.card { background: #fff; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); padding: 1.25rem; }
.card-summary-inner { display: flex; gap: 1rem; align-items: flex-start; }
.avatar { width: 64px; height: 64px; border-radius: 50%; background: #f3f4f6; flex-shrink: 0; display: flex; align-items: center; justify-content: center; overflow: hidden; }
.card-summary-text { flex: 1; min-width: 0; }
.candidate-name { font-size: 1.5rem; font-weight: 700; margin: 0 0 0.25rem; color: #333; }
.party-pill { display: inline-block; background: #F7A823; color: #fff; font-size: 0.75rem; font-weight: 600; padding: 0.2rem 0.5rem; border-radius: 999px; margin-bottom: 0.25rem; }
.office { font-size: 0.9375rem; color: #6b7280; margin: 0 0 0.35rem; }
.campaign-link { font-size: 0.9375rem; color: #2563eb; text-decoration: none; display: inline-flex; align-items: center; gap: 0.25rem; }
.campaign-link:hover { text-decoration: underline; }
.card-title { font-size: 1rem; font-weight: 700; margin: 0 0 0.75rem; display: flex; align-items: center; gap: 0.5rem; }
.card-icon { flex-shrink: 0; color: #6b7280; }
.card-body { margin: 0; font-size: 0.9375rem; line-height: 1.6; color: #374151; }
.issues-list { list-style: none; padding: 0; margin: 0; }
.issue-item { display: flex; gap: 0.75rem; margin-bottom: 0.75rem; }
.issue-item:last-child { margin-bottom: 0; }
.issue-bar { flex-shrink: 0; width: 4px; background: #F7A823; border-radius: 2px; min-height: 2.5em; }
.issue-title { font-size: 0.9375rem; display: block; margin-bottom: 0.2rem; }
.issue-summary { margin: 0; font-size: 0.9375rem; color: #374151; line-height: 1.5; }
.endorsements-list { list-style: none; padding: 0; margin: 0; font-size: 0.9375rem; color: #374151; }
.endorsements-list li { padding: 0.2rem 0; }
.plain-text-card { background: #fff; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.08); padding: 1.25rem; }
.plain-text-header { display: flex; justify-content: flex-end; margin-bottom: 0.75rem; }
.copy-btn { display: inline-flex; align-items: center; gap: 0.35rem; padding: 0.35rem 0.6rem; font-size: 0.875rem; background: #f3f4f6; border: none; border-radius: 6px; cursor: pointer; color: #374151; }
.copy-btn:hover { background: #e5e7eb; }
.plain-text-body { font-size: 0.9375rem; line-height: 1.6; color: #333; white-space: pre-wrap; }
.plain-text-body h1 { font-size: 1.25rem; margin: 0 0 0.5rem; }
.plain-text-body h2 { font-size: 1rem; margin: 1rem 0 0.35rem; font-weight: 700; }
.plain-text-body .plain-meta, .plain-text-body .plain-url { margin: 0 0 0.5rem; color: #6b7280; }
.plain-text-body ul { margin: 0.5rem 0; padding-left: 1.5rem; }
</style>